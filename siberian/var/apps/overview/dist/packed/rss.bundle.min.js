angular.module("starter").controller("RssGroupController",function($filter,$scope,$state,$stateParams,Rss,Dialog){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,feeds:[]}),Rss.setValueId($stateParams.value_id),$scope.loadContent=function(refresh){Rss.getFeeds(refresh).then(function(data){$scope.feeds=data.feeds,$scope.settings=data.settings,$scope.page_title=data.page_title,Rss.feeds=angular.copy($scope.feeds),Rss.settings=angular.copy($scope.settings),$scope.feeds_chunks=$filter("chunk")($scope.feeds,2),$scope.feeds_achunks=$filter("achunk")($scope.feeds,2,1)},function(error){Dialog.alert("Error","We are unable to find this feed groups.","OK",2350,"rss")}).then(function(){$scope.is_loading=!1})},$scope.thumbnailSrc=function(item){return item.thumbnail.match(/^http/)?item.thumbnail:IMAGE_URL+"images/application"+item.thumbnail},$scope.refresh=function(){$scope.is_loading=!0,$scope.loadContent(!0)},$scope.goToList=function(feed){$state.go("rss-list",{value_id:$scope.value_id,feed_id:feed.id})},$scope.loadContent(!1)}).controller("RssListController",function($filter,$scope,$state,$stateParams,Rss,Pages,Dialog){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,feed_id:$stateParams.feed_id}),Rss.setValueId($stateParams.value_id),Rss.setFeedId($stateParams.feed_id),$scope.loadContent=function(refresh){""!==$scope.feed_id?Rss.getSingleFeed($scope.feed_id,refresh).then(function(data){$scope.collection=data.collection,$scope.settings=data.settings,$scope.page_title=data.page_title,Rss.collection=angular.copy($scope.collection),Rss.settings=angular.copy($scope.settings),$scope.settings.displayCover&&$scope.collection.length>0&&($scope.cover=$scope.collection[0],$scope.collection.shift()),$scope.collection_chunks=$filter("chunk")($scope.collection,2),$scope.collection_achunks=$filter("achunk")($scope.collection,2,1)},function(error){Dialog.alert("Error","We are unable to find this feed groups.","OK",2350,"rss")}).then(function(){$scope.is_loading=!1}):Rss.getGroupedFeeds(refresh).then(function(data){$scope.collection=data.collection,$scope.settings=data.settings,$scope.page_title=data.page_title,Rss.collection=angular.copy($scope.collection),Rss.settings=angular.copy($scope.settings),$scope.settings.displayCover&&$scope.collection.length>0&&($scope.cover=$scope.collection[0],$scope.collection.shift()),$scope.collection_chunks=$filter("chunk")($scope.collection,2),$scope.collection_achunks=$filter("achunk")($scope.collection,2,1)},function(error){Dialog.alert("Error","We are unable to find this feed groups.","OK",2350,"rss")}).then(function(){$scope.is_loading=!1})},$scope.refresh=function(){$scope.is_loading=!0,$scope.loadContent(!0)},$scope.showItem=function(item){$state.go("rss-view",{value_id:$scope.value_id,item_id:item.id})},$scope.loadContent(!1)}).controller("RssViewController",function($rootScope,$scope,$stateParams,LinkService,Rss){angular.extend($scope,{is_loading:!1,value_id:$stateParams.value_id}),Rss.setValueId($stateParams.value_id),Rss.item_id=$stateParams.item_id,$scope.loadContent=function(){$scope.is_loading=!0,Rss.findItem($stateParams.item_id).then(function(item){$scope.item=item,$scope.settings=Rss.settings,$scope.page_title=item.title}).then(function(){$scope.is_loading=!1})},$scope.showItem=function(){$rootScope.isNotAvailableInOverview()||LinkService.openLink($scope.item.link,{},!0)},$scope.loadContent()}),angular.module("starter").factory("Rss",function($pwaRequest){var factory={value_id:null,feed_id:null,extendedOptions:{},collection:[],setValueId:function(valueId){factory.value_id=valueId},setFeedId:function(feedId){factory.feed_id=feedId},setExtendedOptions:function(options){factory.extendedOptions=options},getFeeds:function(refresh){return this.value_id?$pwaRequest.get("rss/mobile_rss/feeds",angular.extend({urlParams:{value_id:this.value_id,refresh:refresh},cache:!1},factory.extendedOptions)):$pwaRequest.reject("[Factory::Rss.getFeeds] missing value_id")},getGroupedFeeds:function(refresh){return this.value_id?$pwaRequest.get("rss/mobile_rss/grouped-feeds",angular.extend({urlParams:{value_id:this.value_id,refresh:refresh},cache:!1},factory.extendedOptions)):$pwaRequest.reject("[Factory::Rss.getGroupedFeeds] missing value_id")},getSingleFeed:function(feedId,refresh){return this.value_id?$pwaRequest.get("rss/mobile_rss/single-feed",{urlParams:{value_id:this.value_id,refresh:refresh,feedId:feedId},cache:!1}):$pwaRequest.reject("[Factory::Rss.getSingleFeed] missing value_id")},findItem:function(itemId){var item=_.filter(factory.collection,function(item){return item.id==itemId})[0];return $pwaRequest.resolve(item)}};return factory});