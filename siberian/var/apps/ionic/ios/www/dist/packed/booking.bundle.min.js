angular.module("starter").controller("BookingController",function($scope,$stateParams,$translate,Booking,Customer,Dialog,Loader){angular.extend($scope,{isLoading:!1,value_id:$stateParams.value_id,formData:{},people:[],cardDesign:!1,settings:{design:"list",datepicker:"single",date_format:"MM/DD/YYYY HH:mm"},dateTime:{date:$translate.instant("Date & time","booking"),checkIn:$translate.instant("Checkin","booking"),checkOut:$translate.instant("Checkout","booking")}}),Booking.setValueId($stateParams.value_id),$scope.coverSrc=function(cover){return IMAGE_URL+"images/application"+cover},$scope.loadContent=function(){$scope.isLoading=!0,Booking.findStores().then(function(data){$scope.populate(data)}).then(function(){$scope.isLoading=!1})},$scope.populate=function(data){$scope.stores=data.stores,$scope.pageTitle=data.pageTitle,$scope.settings=data.settings,$scope.cardDesign="card"===data.settings.design,Customer.isLoggedIn()&&($scope.formData.name=Customer.customer.firstname+" "+Customer.customer.lastname,$scope.formData.email=Customer.customer.email),1===$scope.stores.length&&($scope.formData.store=$scope.stores[0].id)},$scope.clearForm=function(){$scope.formData={},1===$scope.stores.length&&($scope.formData.store=$scope.stores[0].id)},$scope.submitForm=function(){var loaderText=$translate.instant("Sending request ...","booking");Loader.show(loaderText),Booking.submitForm($scope.formData).then(function(data){Dialog.alert("Success",data.message,"OK",2350,"booking"),$scope.formData={}},function(data){var message=$translate.instant("Please fill out the following fields","booking");data.errorLines.forEach(function(item){message+="<br />"+$translate.instant(item,"booking")}),Dialog.alert("Error",message,"OK",-1,"booking")}).then(function(){Loader.hide()})},$scope.loadContent()}),angular.module("starter").factory("Booking",function($pwaRequest){var factory={value_id:null,extendedOptions:{},setValueId:function(value_id){factory.value_id=value_id},setExtendedOptions:function(options){factory.extendedOptions=options},findStores:function(){if(!this.value_id)return $pwaRequest.reject("[Factory::Booking.findStores] missing value_id");var payload=$pwaRequest.getPayloadForValueId(factory.value_id);return!1!==payload?$pwaRequest.resolve(payload):$pwaRequest.get("booking/mobile_view/find",angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions))},submitForm:function(form){if(!this.value_id)return $pwaRequest.reject("[Factory::Booking.submitForm] missing value_id");var data={};for(var prop in form)data[prop]=form[prop];return data.value_id=this.value_id,data.version="2",$pwaRequest.post("booking/mobile_view/post",{urlParams:{value_id:this.value_id},data:data,cache:!1})}};return factory});